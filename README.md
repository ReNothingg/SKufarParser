# Kufar Parser Bot

Телеграм-бот для мониторинга новых объявлений Kufar с мультикатегориями и inline-управлением.

## Возможности

- Одновременный мониторинг нескольких категорий.
- Добавление категории:
  - по ID категории (`17010`);
  - по полной ссылке поиска Kufar (бот сохраняет `cat` и дополнительные query-параметры).
- Включение/пауза/удаление категории из меню.
- Выбор региона и района через inline-кнопки.
- `Baseline` для каждой категории (чтобы не сыпались старые объявления).
- Команда `/all` с выбором категории для ручного пролистывания.
- Кэш фото и отправка галереи (до 10 изображений).
- Сохранение списка категорий между перезапусками (`data/targets.json`).

## Команды

- `/start` - краткая справка.
- `/menu` - основная панель управления.
- `/targets` - быстрый список категорий.
- `/set_location` - смена региона/района.
- `/all` - просмотр объявлений по выбранной категории.

## Как получить ID категории (`cat`)

1. Открой на Kufar нужную категорию.
2. Нажми `F12` и перейди во вкладку `Network`.
3. В строке фильтра введи `cat`.
4. Открой любой запрос из списка.
5. В поле `Request URL` найди параметр `?cat=...`.
6. Возьми число после `?cat=` и отправь его боту в `/menu -> ➕ Добавить`.

Пример: если в URL есть `?cat=17010`, то ID категории = `17010`.

## Быстрый старт (PowerShell)

1. Создай venv и активируй:

```powershell
python -m venv .venv
.venv\Scripts\Activate.ps1
```

1. Установи зависимости:

```powershell
pip install -r requirements.txt
```

1. Создай `.env`:

```powershell
Copy-Item .env.example .env
```

1. Заполни `.env` и запусти:

```powershell
python main.py
```

## Переменные окружения

- `BOT_TOKEN` - токен Telegram-бота.
- `USER_ID` - Telegram user ID, куда отправлять мониторинг.
- `CHECK_INTERVAL` - интервал проверки, сек (по умолчанию `60`).
- `LOCATIONS_FILE` - путь к `locations.json`.
- `TARGETS_FILE` - путь к JSON с категориями (по умолчанию `data/targets.json`).
- `KUFAR_AUTH_TOKEN` - опциональный токен авторизации Kufar.
- `KUFAR_USER_AGENT` - User-Agent для запросов.
